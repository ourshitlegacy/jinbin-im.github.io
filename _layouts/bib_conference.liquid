{% if group_key != prev_group_key %}
  {% if prev_group_key %}
        </div> <!-- conf-group-content Îã´Í∏∞ -->
      </div> <!-- conf-group Îã´Í∏∞ -->
    {% endif %}
  {% endif %}

  {% assign year = group_key | split: ',' | first %}
  {% assign conf = group_key | split: ',' | last | strip %}
  
  {% if year != prev_year %}
    {% if prev_year %}
      </div> <!-- year-group Îã´Í∏∞ -->
    {% endif %}
    <div class="year-group">
      <h2 class="year-title">{{ year }}</h2>
    {% assign prev_year = year %}
  {% endif %}
  
  {% assign conf_base = conf | remove: year | strip %}
  {% assign conf_logo_color = "" %}
  {% assign conf_full_name = "" %}
  
  {% if conf contains "ICCEPM" %}
    {% assign conf_logo_color = "background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" %}
    {% assign conf_full_name = "International Conference on Construction Engineering and Project Management" %}
  {% elsif conf contains "ISARC" %}
    {% assign conf_logo_color = "background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" %}
    {% assign conf_full_name = "International Symposium on Automation and Robotics in Construction" %}
  {% else %}
    {% assign conf_logo_color = "background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" %}
    {% assign conf_full_name = conf %}
  {% endif %}
  
  <div class="conf-group">
    <div class="conf-group-logo" style="{{ conf_logo_color }}">
      <span style="color: white; font-size: 1.1rem; font-weight: 700; text-align: center; padding: 10px; line-height: 1.3;">{{ conf_base }}<br>{{ year }}</span>
    </div>
    <div class="conf-group-content">
      <div class="conf-group-title">{{ conf_full_name }} {{ year }}</div>
      
  {% assign prev_group_key = group_key %}
{% endif %}

<style>
.author-me {
  color: #7b27d8 !important;
  font-weight: 700 !important;
  font-style: normal !important;
  text-decoration: none !important;
}

.conf-location {
  display: inline-block;
  background: #7b27d8;
  color: white;
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 0.85rem;
  font-weight: 500;
  margin-left: 10px;
}

.abstract.hidden,
.bibtex.hidden {
  display: none;
}

.abstract,
.bibtex {
  margin-top: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-left: 3px solid #7b27d8;
  border-radius: 4px;
}
</style>

<div class="conf-item mb-4 pb-3">
  {%- assign conf_name = entry.booktitle | default: entry.series | default: entry.journal -%}
  {%- assign conf_loc  = entry.location | default: entry.address -%}

  <!-- ÏÉÅÎã®: Ïª®ÌçºÎü∞Ïä§ Ïù¥Î¶Ñ + ÏßÄÏó≠ -->
  <div class="conf-meta d-flex flex-wrap align-items-center mb-2">
    <span class="conf-name flex-grow-1 px-2 py-1">{{ conf_name }}</span>
    {% if conf_loc %}
      <span class="conf-location">üìç {{ conf_loc }}</span>
    {% endif %}
  </div>

  <!-- Ï†úÎ™© -->
  <div class="conf-title h5 mb-1">{{ entry.title }}</div>

  <!-- Ï†ÄÏûê -->
  <div class="conf-authors mb-2">
    {% assign author_array_size = entry.author_array | size %}
    {% for author in entry.author_array %}
      {%- assign author_is_self = false -%}
      {%- assign author_last_name = author.last | remove: "¬∂" | remove: "&" | remove: "*" | remove: "‚Ä†" | remove: "^" -%}
      
      {%- if site.scholar.last_name contains author_last_name -%}
        {%- if site.scholar.first_name contains author.first -%}
          {%- assign author_is_self = true -%}
        {%- endif -%}
      {%- endif -%}

      {%- assign coauthor_url = nil -%}
      {%- assign clean_last_name = author_last_name | downcase | remove: "." -%}
      {% if site.data.coauthors[clean_last_name] %}
        {% for coauthor in site.data.coauthors[clean_last_name] %}
          {% if coauthor.firstname contains author.first %}
            {% if coauthor.scholar_id %}
              {% assign coauthor_url = "https://scholar.google.com/citations?user=" | append: coauthor.scholar_id %}
            {% elsif coauthor.url %}
              {% assign coauthor_url = coauthor.url %}
            {% endif %}
            {% break %}
          {% endif %}
        {% endfor %}
      {% endif %}

      {% if author_is_self %}
        <span class="author-me">{{ author.first }} {{ author.last }}</span>
      {% else %}
        {% if coauthor_url %}
          <a href="{{ coauthor_url }}">{{ author.first }} {{ author.last }}</a>
        {% else %}
          {{ author.first }} {{ author.last }}
        {% endif %}
      {% endif %}

      {%- if forloop.last == false -%}
        {%- if forloop.index == author_array_size | minus: 1 -%}
          , and&nbsp;
        {%- else -%}
          ,&nbsp;
        {%- endif -%}
      {%- endif -%}
    {% endfor %}
  </div>

  <!-- Î≤ÑÌäºÎì§ -->
  <div class="links">
    {% if entry.abstract %}
      <a class="abstract btn btn-sm z-depth-0" role="button">Abs</a>
    {% endif %}
    {% if entry.doi %}
      <a href="https://doi.org/{{ entry.doi }}" class="btn btn-sm z-depth-0" role="button">DOI</a>
    {% endif %}
    {% if entry.url %}
      <a href="{{ entry.url }}" class="btn btn-sm z-depth-0" role="button">URL</a>
    {% endif %}
    {%- if entry.arxiv %}
      <a href="http://arxiv.org/abs/{{ entry.arxiv }}" class="btn btn-sm z-depth-0" role="button">arXiv</a>
    {%- endif %}
    {%- if entry.bibtex_show %}
      <a class="bibtex btn btn-sm z-depth-0" role="button">Bib</a>
    {%- endif %}
    {%- if entry.pdf %}
      {% if entry.pdf contains '://' %}
        <a href="{{ entry.pdf }}" class="btn btn-sm z-depth-0" role="button">PDF</a>
      {% else %}
        <a href="{{ entry.pdf | prepend: '/assets/pdf/' | relative_url }}" class="btn btn-sm z-depth-0" role="button">PDF</a>
      {% endif %}
    {%- endif %}
  </div>

  <!-- Ïà®ÍπÄ ÏòÅÏó≠: Ï¥àÎ°ù -->
  {% if entry.abstract %}
    <div class="abstract hidden">
      <p>{{ entry.abstract }}</p>
    </div>
  {% endif %}

  <!-- Ïà®ÍπÄ ÏòÅÏó≠: BibTeX -->
  {% if entry.bibtex_show %}
    <div class="bibtex hidden">
      {% highlight bibtex %}{{ entry.bibtex }}{% endhighlight %}
    </div>
  {% endif %}
</div>

<script>
$(document).ready(function() {
  $('.links .abstract').click(function() {
    $(this).closest('.conf-item').find('.abstract.hidden').slideToggle();
  });
  $('.links .bibtex').click(function() {
    $(this).closest('.conf-item').find('.bibtex.hidden').slideToggle();
  });
});
</script>
