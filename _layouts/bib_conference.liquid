<div class="row pub-row conference-row" 
     data-year="{{entry.year}}"
     data-conference="{{entry.conference}}"
     data-booktitle="{{entry.booktitle}}"
     data-address="{{entry.address}}"
     data-month="{{entry.month}}">
  <div id="{{entry.key}}" class="col-sm-10">
    {% if entry.type == "thesis" %}
      {{reference}}
    {% else %}
      <!-- 제목 with 링크 -->
      <div class="title">
        {% if entry.url %}
          <a href="{{ entry.url }}" target="_blank">{{entry.title}}</a>
        {% elsif entry.doi %}
          <a href="https://doi.org/{{ entry.doi }}" target="_blank">{{entry.title}}</a>
        {% else %}
          {{entry.title}}
        {% endif %}
      </div>

      <!-- 저자 -->
      <div class="author">
        {% assign author_array_size = entry.author_array | size %}
        
        {%- for author in entry.author_array -%}
          {%- assign author_is_self = false -%}
          {%- assign author_last_name = author.last | remove: "¶" | remove: "&" | remove: "*" | remove: "†" | remove: "^" -%}
          {%- if site.scholar.last_name contains author_last_name -%}
            {%- if site.scholar.first_name contains author.first -%}
              {%- assign author_is_self = true -%}
            {%- endif -%}
          {%- endif -%}
          {%- assign coauthor_url = nil -%}
          {%- assign clean_last_name = author_last_name | downcase | remove: "." -%}
          {%- if site.data.coauthors[clean_last_name] -%}
            {%- for coauthor in site.data.coauthors[clean_last_name] -%}
              {%- if coauthor.firstname contains author.first -%}
                {%- assign coauthor_url = coauthor.url -%}
                {%- break -%}
              {%- endif -%}
            {%- endfor -%}
          {%- endif -%}
          
          {% if author_is_self %}
            <span class="author-me">{{author.first}} {{author.last}}</span>
          {% else %}
            {% if coauthor_url %}
              <a href="{{coauthor_url}}">{{author.first}} {{author.last}}</a>
            {% else %}
              {{author.first}} {{author.last}}
            {% endif %}
          {% endif %}
          
          {%- if forloop.last == false -%}
            {%- if forloop.index == author_array_size | minus: 1 -%}
              , and&nbsp;
            {%- else -%}
              ,&nbsp;
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
      </div>

      <!-- Booktitle (헤더에서 표시하므로 여기서는 숨김) -->
      {% if entry.booktitle %}
        <div class="periodical" style="display: none;">
          <em>{{entry.booktitle}}</em>
        </div>
      {% endif %}
    {% endif %}

    <!-- 버튼들 -->
    <div class="links">
      {%- if entry.abstract %}
        <a href="#" class="abstract-toggle btn btn-sm z-depth-0" role="button">ABS</a>
      {%- endif %}
      {%- if entry.bibtex_show %}
        <a href="#" class="bibtex-toggle btn btn-sm z-depth-0" role="button">BIB</a>
      {%- endif %}
      {%- if entry.pdf %}
        {% if entry.pdf contains '://' %}
          <a href="{{ entry.pdf }}" class="btn btn-sm z-depth-0" role="button" target="_blank">PDF</a>
        {% else %}
          <a href="{{ entry.pdf | prepend: '/assets/pdf/' | relative_url }}" class="btn btn-sm z-depth-0" role="button" target="_blank">PDF</a>
        {% endif %}
      {%- endif %}
    </div>

    <!-- Abstract (토글 - 기본 숨김) -->
    {% if entry.abstract %}
      <div class="abstract hidden">
        <p>{{ entry.abstract }}</p>
      </div>
    {% endif %}

    <!-- BibTeX (숨김, 필요시 버튼 추가) -->
    {% if entry.bibtex_show %}
      <div class="bibtex hidden">
        {% highlight bibtex %}{{ entry.bibtex }}{% endhighlight %}
      </div>
    {% endif %}
  </div>
</div>

<style>
.author-me {
  color: #7b27d8 !important;
  font-weight: 700 !important;
  font-style: normal !important;
  text-decoration: none !important;
}

/* 왼쪽 중복 연도 숨김 */
.pub-year {
  display: none !important;
}

/* 제목 링크 스타일 */
.title a {
  color: inherit;
  text-decoration: none;
}

.title a:hover {
  color: #7b27d8;
  text-decoration: underline;
}

/* Bibtex/Abstract 숨김 스타일 */
.abstract.hidden,
.bibtex.hidden {
  display: none;
}

.abstract,
.bibtex {
  margin-top: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-left: 3px solid #7b27d8;
  border-radius: 4px;
}

/* Conference row 스타일 */
.conference-row {
  margin-bottom: 2rem;
  padding-left: 1rem;
}
</style>

<script>
// 토글 기능
(function() {
  if (window.confTogglesInitialized) return;
  window.confTogglesInitialized = true;

  document.addEventListener('click', function(e) {
    // Abstract 토글
    if (e.target.classList.contains('abstract-toggle')) {
      e.preventDefault();
      const row = e.target.closest('.conference-row');
      if (row) {
        const abstractDiv = row.querySelector('.abstract');
        if (abstractDiv) {
          abstractDiv.classList.toggle('hidden');
        }
      }
    }
    
    // BibTeX 토글
    if (e.target.classList.contains('bibtex-toggle')) {
      e.preventDefault();
      const row = e.target.closest('.conference-row');
      if (row) {
        const bibtexDiv = row.querySelector('.bibtex');
        if (bibtexDiv) {
          bibtexDiv.classList.toggle('hidden');
        }
      }
    }
  });
})();
</script>
